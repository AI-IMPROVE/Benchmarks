# Improving cancer type classifier with synthetic data

We demonstrate the value of generator models in boosting the performance of predictive models.
In this example, we first train a conditional variational autoencoder (CVAE) to learn the distribution of RNAseq data for cancer cell line samples. We then generate synthetic samples by sampling from the latent representation along with a random type index. Adding the synthetic samples to the original training data, we hypothesize that a model trained under the otherwise same conditions would get enhanced performance. This is validated by our experiments in training a simple type classifier network and testing the classification accuracy on the holdout data not seen by the generator.

![Test accuracy comparison](test-accuracy-comparison-20-types.png)


## Example 1

Training with 10,000 synthetic samples on the 10-type classification problem. 
```
python rnagen.py --top_k_types 10 --n_samples 10000
```

```
Train a type classifier:
Epoch 1/2
 1/14 [=>............................] - ETA: 0s - loss: 2.3612 - accuracy: 0.066414/14 [==============================] - 0s 16ms/step - loss: 2.1176 - accuracy: 0.2756 - val_loss: 1.8421 - val_accuracy: 0.2835
Epoch 2/2
 1/14 [=>............................] - ETA: 0s - loss: 1.8119 - accuracy: 0.324214/14 [==============================] - 0s 4ms/step - loss: 1.6457 - accuracy: 0.5947 - val_loss: 1.3630 - val_accuracy: 0.7664

Evaluate on test data:
 1/30 [>.............................] - ETA: 0s - loss: 1.2720 - accuracy: 0.898430/30 [==============================] - ETA: 0s - loss: 1.3624 - accuracy: 0.767930/30 [==============================] - 0s 2ms/step - loss: 1.3624 - accuracy: 0.7679

Train conditional autoencoder:
Epoch 1/20
 1/27 [>.............................] - ETA: 0s - loss: 2.9534 - kl: 2.2589 - xent: 0.6944 - mse: 0.0291 - corr: -0.004014/27 [==============>...............] - ETA: 0s - loss: 1.1245 - kl: 0.4389 - xent: 0.6856 - mse: 0.0252 - corr: 0.3712 25/27 [==========================>...] - ETA: 0s - loss: 0.9378 - kl: 0.2594 - xent: 0.6784 - mse: 0.0215 - corr: 0.492527/27 [==============================] - 0s 15ms/step - loss: 0.9212 - kl: 0.2417 - xent: 0.6775 - mse: 0.0210 - corr: 0.5072 - val_loss: 0.6825 - val_kl: 0.0191 - val_xent: 0.6634 - val_mse: 0.0144 - val_corr: 0.7024
Epoch 2/20
 1/27 [>.............................] - ETA: 0s - loss: 0.6820 - kl: 0.0181 - xent: 0.6638 - mse: 0.0134 - corr: 0.716512/27 [============>.................] - ETA: 0s - loss: 0.6763 - kl: 0.0140 - xent: 0.6623 - mse: 0.0139 - corr: 0.713223/27 [========================>.....] - ETA: 0s - loss: 0.6728 - kl: 0.0113 - xent: 0.6615 - mse: 0.0135 - corr: 0.720927/27 [==============================] - 0s 6ms/step - loss: 0.6720 - kl: 0.0107 - xent: 0.6613 - mse: 0.0134 - corr: 0.7228 - val_loss: 0.6661 - val_kl: 0.0067 - val_xent: 0.6594 - val_mse: 0.0128 - val_corr: 0.7385
Epoch 3/20
 1/27 [>.............................] - ETA: 0s - loss: 0.6664 - kl: 0.0070 - xent: 0.6594 - mse: 0.0133 - corr: 0.730111/27 [===========>..................] - ETA: 0s - loss: 0.6656 - kl: 0.0061 - xent: 0.6595 - mse: 0.0129 - corr: 0.737922/27 [=======================>......] - ETA: 0s - loss: 0.6652 - kl: 0.0057 - xent: 0.6594 - mse: 0.0127 - corr: 0.740027/27 [==============================] - 0s 6ms/step - loss: 0.6650 - kl: 0.0056 - xent: 0.6594 - mse: 0.0126 - corr: 0.7420 - val_loss: 0.6632 - val_kl: 0.0049 - val_xent: 0.6583 - val_mse: 0.0123 - val_corr: 0.7506
Epoch 4/20
 1/27 [>.............................] - ETA: 0s - loss: 0.6642 - kl: 0.0049 - xent: 0.6593 - mse: 0.0123 - corr: 0.748011/27 [===========>..................] - ETA: 0s - loss: 0.6633 - kl: 0.0047 - xent: 0.6586 - mse: 0.0125 - corr: 0.747021/27 [======================>.......] - ETA: 0s - loss: 0.6628 - kl: 0.0045 - xent: 0.6583 - mse: 0.0122 - corr: 0.753527/27 [==============================] - 0s 6ms/step - loss: 0.6625 - kl: 0.0044 - xent: 0.6581 - mse: 0.0121 - corr: 0.7557 - val_loss: 0.6607 - val_kl: 0.0040 - val_xent: 0.6568 - val_mse: 0.0116 - val_corr: 0.7671
Epoch 5/20
 1/27 [>.............................] - ETA: 0s - loss: 0.6604 - kl: 0.0039 - xent: 0.6564 - mse: 0.0110 - corr: 0.775913/27 [=============>................] - ETA: 0s - loss: 0.6606 - kl: 0.0039 - xent: 0.6567 - mse: 0.0116 - corr: 0.768024/27 [=========================>....] - ETA: 0s - loss: 0.6603 - kl: 0.0038 - xent: 0.6565 - mse: 0.0113 - corr: 0.773127/27 [==============================] - 0s 6ms/step - loss: 0.6601 - kl: 0.0038 - xent: 0.6563 - mse: 0.0113 - corr: 0.7743 - val_loss: 0.6586 - val_kl: 0.0036 - val_xent: 0.6550 - val_mse: 0.0108 - val_corr: 0.7846
Epoch 6/20
 1/27 [>.............................] - ETA: 0s - loss: 0.6580 - kl: 0.0033 - xent: 0.6546 - mse: 0.0106 - corr: 0.787912/27 [============>.................] - ETA: 0s - loss: 0.6583 - kl: 0.0036 - xent: 0.6547 - mse: 0.0108 - corr: 0.786823/27 [========================>.....] - ETA: 0s - loss: 0.6582 - kl: 0.0034 - xent: 0.6548 - mse: 0.0106 - corr: 0.789327/27 [==============================] - 0s 6ms/step - loss: 0.6582 - kl: 0.0034 - xent: 0.6548 - mse: 0.0106 - corr: 0.7899 - val_loss: 0.6569 - val_kl: 0.0032 - val_xent: 0.6537 - val_mse: 0.0102 - val_corr: 0.7983
Epoch 7/20
 1/27 [>.............................] - ETA: 0s - loss: 0.6571 - kl: 0.0032 - xent: 0.6539 - mse: 0.0102 - corr: 0.799112/27 [============>.................] - ETA: 0s - loss: 0.6569 - kl: 0.0031 - xent: 0.6538 - mse: 0.0102 - corr: 0.799124/27 [=========================>....] - ETA: 0s - loss: 0.6568 - kl: 0.0031 - xent: 0.6537 - mse: 0.0101 - corr: 0.800327/27 [==============================] - 0s 5ms/step - loss: 0.6568 - kl: 0.0031 - xent: 0.6537 - mse: 0.0101 - corr: 0.8007 - val_loss: 0.6559 - val_kl: 0.0030 - val_xent: 0.6529 - val_mse: 0.0099 - val_corr: 0.8048
Epoch 8/20
 1/27 [>.............................] - ETA: 0s - loss: 0.6561 - kl: 0.0029 - xent: 0.6532 - mse: 0.0094 - corr: 0.812312/27 [============>.................] - ETA: 0s - loss: 0.6563 - kl: 0.0030 - xent: 0.6533 - mse: 0.0098 - corr: 0.806123/27 [========================>.....] - ETA: 0s - loss: 0.6560 - kl: 0.0029 - xent: 0.6531 - mse: 0.0098 - corr: 0.806827/27 [==============================] - 0s 6ms/step - loss: 0.6559 - kl: 0.0028 - xent: 0.6531 - mse: 0.0098 - corr: 0.8061 - val_loss: 0.6551 - val_kl: 0.0028 - val_xent: 0.6523 - val_mse: 0.0097 - val_corr: 0.8097
Epoch 9/20
 1/27 [>.............................] - ETA: 0s - loss: 0.6555 - kl: 0.0026 - xent: 0.6530 - mse: 0.0090 - corr: 0.820612/27 [============>.................] - ETA: 0s - loss: 0.6555 - kl: 0.0027 - xent: 0.6529 - mse: 0.0095 - corr: 0.811623/27 [========================>.....] - ETA: 0s - loss: 0.6554 - kl: 0.0026 - xent: 0.6527 - mse: 0.0097 - corr: 0.810227/27 [==============================] - 0s 6ms/step - loss: 0.6553 - kl: 0.0026 - xent: 0.6527 - mse: 0.0097 - corr: 0.8097 - val_loss: 0.6546 - val_kl: 0.0025 - val_xent: 0.6521 - val_mse: 0.0096 - val_corr: 0.8114
Epoch 10/20
 1/27 [>.............................] - ETA: 0s - loss: 0.6553 - kl: 0.0025 - xent: 0.6529 - mse: 0.0090 - corr: 0.822812/27 [============>.................] - ETA: 0s - loss: 0.6548 - kl: 0.0024 - xent: 0.6524 - mse: 0.0095 - corr: 0.814024/27 [=========================>....] - ETA: 0s - loss: 0.6548 - kl: 0.0024 - xent: 0.6524 - mse: 0.0096 - corr: 0.811227/27 [==============================] - 0s 5ms/step - loss: 0.6548 - kl: 0.0024 - xent: 0.6524 - mse: 0.0096 - corr: 0.8114 - val_loss: 0.6543 - val_kl: 0.0023 - val_xent: 0.6520 - val_mse: 0.0095 - val_corr: 0.8125
Epoch 11/20
 1/27 [>.............................] - ETA: 0s - loss: 0.6551 - kl: 0.0023 - xent: 0.6528 - mse: 0.0097 - corr: 0.809312/27 [============>.................] - ETA: 0s - loss: 0.6543 - kl: 0.0022 - xent: 0.6521 - mse: 0.0095 - corr: 0.815523/27 [========================>.....] - ETA: 0s - loss: 0.6545 - kl: 0.0022 - xent: 0.6523 - mse: 0.0096 - corr: 0.812427/27 [==============================] - 0s 6ms/step - loss: 0.6545 - kl: 0.0022 - xent: 0.6523 - mse: 0.0096 - corr: 0.8124 - val_loss: 0.6541 - val_kl: 0.0021 - val_xent: 0.6519 - val_mse: 0.0095 - val_corr: 0.8134
Epoch 12/20
 1/27 [>.............................] - ETA: 0s - loss: 0.6549 - kl: 0.0021 - xent: 0.6527 - mse: 0.0103 - corr: 0.799412/27 [============>.................] - ETA: 0s - loss: 0.6547 - kl: 0.0021 - xent: 0.6526 - mse: 0.0095 - corr: 0.811623/27 [========================>.....] - ETA: 0s - loss: 0.6543 - kl: 0.0021 - xent: 0.6523 - mse: 0.0096 - corr: 0.811227/27 [==============================] - 0s 6ms/step - loss: 0.6543 - kl: 0.0021 - xent: 0.6522 - mse: 0.0095 - corr: 0.8135 - val_loss: 0.6538 - val_kl: 0.0020 - val_xent: 0.6518 - val_mse: 0.0094 - val_corr: 0.8147
Epoch 13/20
 1/27 [>.............................] - ETA: 0s - loss: 0.6542 - kl: 0.0021 - xent: 0.6521 - mse: 0.0087 - corr: 0.826512/27 [============>.................] - ETA: 0s - loss: 0.6541 - kl: 0.0020 - xent: 0.6521 - mse: 0.0096 - corr: 0.812223/27 [========================>.....] - ETA: 0s - loss: 0.6541 - kl: 0.0020 - xent: 0.6522 - mse: 0.0095 - corr: 0.813327/27 [==============================] - 0s 6ms/step - loss: 0.6541 - kl: 0.0019 - xent: 0.6521 - mse: 0.0095 - corr: 0.8139 - val_loss: 0.6537 - val_kl: 0.0019 - val_xent: 0.6518 - val_mse: 0.0094 - val_corr: 0.8146
Epoch 14/20
 1/27 [>.............................] - ETA: 0s - loss: 0.6537 - kl: 0.0018 - xent: 0.6518 - mse: 0.0100 - corr: 0.808512/27 [============>.................] - ETA: 0s - loss: 0.6536 - kl: 0.0019 - xent: 0.6517 - mse: 0.0096 - corr: 0.814722/27 [=======================>......] - ETA: 0s - loss: 0.6538 - kl: 0.0018 - xent: 0.6520 - mse: 0.0094 - corr: 0.816127/27 [==============================] - 0s 6ms/step - loss: 0.6539 - kl: 0.0018 - xent: 0.6521 - mse: 0.0095 - corr: 0.8145 - val_loss: 0.6535 - val_kl: 0.0018 - val_xent: 0.6517 - val_mse: 0.0094 - val_corr: 0.8150
Epoch 15/20
 1/27 [>.............................] - ETA: 0s - loss: 0.6536 - kl: 0.0016 - xent: 0.6520 - mse: 0.0088 - corr: 0.827712/27 [============>.................] - ETA: 0s - loss: 0.6540 - kl: 0.0018 - xent: 0.6523 - mse: 0.0096 - corr: 0.812923/27 [========================>.....] - ETA: 0s - loss: 0.6537 - kl: 0.0017 - xent: 0.6520 - mse: 0.0094 - corr: 0.815227/27 [==============================] - 0s 6ms/step - loss: 0.6538 - kl: 0.0017 - xent: 0.6521 - mse: 0.0095 - corr: 0.8145 - val_loss: 0.6534 - val_kl: 0.0017 - val_xent: 0.6517 - val_mse: 0.0094 - val_corr: 0.8147
Epoch 16/20
 1/27 [>.............................] - ETA: 0s - loss: 0.6527 - kl: 0.0018 - xent: 0.6509 - mse: 0.0086 - corr: 0.830412/27 [============>.................] - ETA: 0s - loss: 0.6536 - kl: 0.0016 - xent: 0.6520 - mse: 0.0095 - corr: 0.815322/27 [=======================>......] - ETA: 0s - loss: 0.6535 - kl: 0.0016 - xent: 0.6519 - mse: 0.0094 - corr: 0.816227/27 [==============================] - 0s 6ms/step - loss: 0.6536 - kl: 0.0016 - xent: 0.6520 - mse: 0.0095 - corr: 0.8149 - val_loss: 0.6533 - val_kl: 0.0016 - val_xent: 0.6517 - val_mse: 0.0094 - val_corr: 0.8147
Epoch 17/20
 1/27 [>.............................] - ETA: 0s - loss: 0.6538 - kl: 0.0016 - xent: 0.6522 - mse: 0.0103 - corr: 0.802912/27 [============>.................] - ETA: 0s - loss: 0.6536 - kl: 0.0016 - xent: 0.6520 - mse: 0.0094 - corr: 0.815523/27 [========================>.....] - ETA: 0s - loss: 0.6535 - kl: 0.0015 - xent: 0.6520 - mse: 0.0095 - corr: 0.815327/27 [==============================] - 0s 6ms/step - loss: 0.6535 - kl: 0.0015 - xent: 0.6520 - mse: 0.0094 - corr: 0.8152 - val_loss: 0.6532 - val_kl: 0.0015 - val_xent: 0.6517 - val_mse: 0.0094 - val_corr: 0.8152
Epoch 18/20
 1/27 [>.............................] - ETA: 0s - loss: 0.6533 - kl: 0.0014 - xent: 0.6518 - mse: 0.0090 - corr: 0.821312/27 [============>.................] - ETA: 0s - loss: 0.6533 - kl: 0.0015 - xent: 0.6519 - mse: 0.0094 - corr: 0.815425/27 [==========================>...] - ETA: 0s - loss: 0.6535 - kl: 0.0014 - xent: 0.6521 - mse: 0.0095 - corr: 0.814727/27 [==============================] - 0s 5ms/step - loss: 0.6535 - kl: 0.0014 - xent: 0.6521 - mse: 0.0095 - corr: 0.8145 - val_loss: 0.6531 - val_kl: 0.0014 - val_xent: 0.6517 - val_mse: 0.0094 - val_corr: 0.8147
Epoch 19/20
 1/27 [>.............................] - ETA: 0s - loss: 0.6540 - kl: 0.0015 - xent: 0.6526 - mse: 0.0096 - corr: 0.813212/27 [============>.................] - ETA: 0s - loss: 0.6533 - kl: 0.0013 - xent: 0.6520 - mse: 0.0095 - corr: 0.814723/27 [========================>.....] - ETA: 0s - loss: 0.6534 - kl: 0.0013 - xent: 0.6521 - mse: 0.0094 - corr: 0.815727/27 [==============================] - 0s 6ms/step - loss: 0.6533 - kl: 0.0013 - xent: 0.6520 - mse: 0.0094 - corr: 0.8156 - val_loss: 0.6530 - val_kl: 0.0014 - val_xent: 0.6517 - val_mse: 0.0094 - val_corr: 0.8152
Epoch 20/20
 1/27 [>.............................] - ETA: 0s - loss: 0.6528 - kl: 0.0012 - xent: 0.6517 - mse: 0.0087 - corr: 0.825112/27 [============>.................] - ETA: 0s - loss: 0.6529 - kl: 0.0013 - xent: 0.6517 - mse: 0.0093 - corr: 0.819323/27 [========================>.....] - ETA: 0s - loss: 0.6532 - kl: 0.0013 - xent: 0.6519 - mse: 0.0094 - corr: 0.815327/27 [==============================] - 0s 6ms/step - loss: 0.6532 - kl: 0.0013 - xent: 0.6520 - mse: 0.0094 - corr: 0.8151 - val_loss: 0.6530 - val_kl: 0.0013 - val_xent: 0.6517 - val_mse: 0.0094 - val_corr: 0.8149

Generate 10000 RNAseq samples:
Done in 0.212 seconds (47255.2 samples/s).

Train a type classifier with synthetic data:
3806 + 10000 = 13806 samples
Epoch 1/2
 1/49 [..............................] - ETA: 0s - loss: 2.5122 - accuracy: 0.089823/49 [=============>................] - ETA: 0s - loss: 2.0285 - accuracy: 0.363544/49 [=========================>....] - ETA: 0s - loss: 1.6885 - accuracy: 0.590149/49 [==============================] - 0s 5ms/step - loss: 1.6122 - accuracy: 0.6193 - val_loss: 0.8120 - val_accuracy: 0.9435
Epoch 2/2
 1/49 [..............................] - ETA: 0s - loss: 0.8186 - accuracy: 0.937523/49 [=============>................] - ETA: 0s - loss: 0.5912 - accuracy: 0.944545/49 [==========================>...] - ETA: 0s - loss: 0.4655 - accuracy: 0.950949/49 [==============================] - 0s 3ms/step - loss: 0.4497 - accuracy: 0.9515 - val_loss: 0.2579 - val_accuracy: 0.9580

Evaluate again on original test data:
 1/30 [>.............................] - ETA: 0s - loss: 0.7183 - accuracy: 0.765625/30 [========================>.....] - ETA: 0s - loss: 0.4372 - accuracy: 0.890630/30 [==============================] - 0s 2ms/step - loss: 0.5237 - accuracy: 0.8583
Test accuracy change: +11.77% (0.7679 -> 0.8583)
```

## Example 2:

Compare and plot model performance. 

```
python rnagen.py --plot
```

```
...

Plot test accuracy using models trained with and without synthetic data:
training time: before vs after
# epochs = 1: 0.4224 vs 0.6909
# epochs = 2: 0.4772 vs 0.7372
# epochs = 3: 0.6468 vs 0.7802
# epochs = 4: 0.7450 vs 0.8175
# epochs = 5: 0.7399 vs 0.8379
# epochs = 6: 0.7843 vs 0.8542
# epochs = 7: 0.8338 vs 0.8642
# epochs = 8: 0.8217 vs 0.8649
# epochs = 9: 0.8195 vs 0.8729
# epochs = 10: 0.8246 vs 0.8625
# epochs = 11: 0.8445 vs 0.8721
# epochs = 12: 0.8539 vs 0.8831
# epochs = 13: 0.8551 vs 0.8882
# epochs = 14: 0.8658 vs 0.8848
# epochs = 15: 0.8649 vs 0.8991
# epochs = 16: 0.8743 vs 0.8896
# epochs = 17: 0.8833 vs 0.8954
# epochs = 18: 0.8777 vs 0.8984
# epochs = 19: 0.8801 vs 0.8961
# epochs = 20: 0.8773 vs 0.9010
```
